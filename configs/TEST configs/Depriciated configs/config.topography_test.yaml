# Topography-focused config scaffold (ready for future topo test images).

channel_defaults:
  topography_family: "height"

modes:
  topography_flat:
    channel_family: "height"
    # Prefer Gwyddion ops list; falls back to legacy flags if omitted.
    gwyddion_ops:
      - { op: "plane_level" }
      # Uncomment if line correction is desired:
      # - { op: "align_rows", params: { direction: "horizontal", method: "median" } }
      - { op: "median", params: { size: 3 } }
      # - { op: "clip_percentiles", params: { low: 0.5, high: 99.5 } }
    mask: null
    stats_filter:
      exclude_nonpositive: false
      on_empty: "warn"
    metric_type: "topography_height"
    units: "nm"
    expected_units: "nm"
    on_unit_mismatch: "warn"

grid:
  index_base: 1
  filename_regex: "LOC_RC(?P<row>\\d{3})(?P<col>\\d{3})"

summarize:
  recursive: false

debug:
  enable: true
  level: "info"
  artifacts: ["leveled", "aligned", "filtered"]
  sample_limit: 3
  out_dir: "out/debug"
  log_fields: ["units", "stats_counts", "grid"]
  trace_dir: "out/debug/traces"

csv_modes:
  default_scalar:
    columns:
      - { name: "source_file", from: "core.source_file" }
      - { name: "mode", from: "core.mode" }
      - { name: "metric_type", from: "core.metric_type" }
      - { name: "avg_value", from: "core.avg_value" }
      - { name: "std_value", from: "core.std_value" }
      - { name: "units", from: "core.units" }
      - { name: "nx", from: "core.nx" }
      - { name: "ny", from: "core.ny" }
      - { name: "row_idx", from: "grid.row_idx", default: -1 }
      - { name: "col_idx", from: "grid.col_idx", default: -1 }
    on_missing_field: "warn_null"

result_schemas:
  default_scalar:
    from_csv_mode: "default_scalar"
    fields:
      - { field: "source_file", type: "string", column: "source_file" }
      - { field: "mode", type: "string", column: "mode" }
      - { field: "metric_type", type: "string", column: "metric_type" }
      - { field: "avg_value", type: "float", column: "avg_value" }
      - { field: "std_value", type: "float", column: "std_value" }
      - { field: "units", type: "string", column: "units" }
      - { field: "nx", type: "int", column: "nx" }
      - { field: "ny", type: "int", column: "ny" }
      - { field: "row_idx", type: "int", column: "row_idx" }
      - { field: "col_idx", type: "int", column: "col_idx" }

plotting_modes:
  sample_bar_with_error:
    result_schema: "default_scalar"
    recipe: "sample_bar_with_error"
    title: "Topography Means (nm)"
    ylabel: "Height (nm)"
  heatmap_grid:
    result_schema: "default_scalar"
    recipe: "heatmap_grid"
    title: "Topography Heatmap (nm)"
    colorbar_label: "avg_value"
    duplicate_policy: "warn_mean"
  heatmap_grid_std:
    result_schema: "default_scalar"
    recipe: "heatmap_grid"
    value_field: "std_value"
    title: "Topography Std Heatmap (nm)"
    colorbar_label: "std_value"
    duplicate_policy: "warn_mean"
    cmap: "magma"
    overlay_std:
      enable: true
      value_field: "std_value"
      text_fmt: "{val:.1f}"
      sigma_bins: [1.0, 2.0, 3.0, 5.0]
      colors: ["#006400", "#ffa500", "#ff4500", "#8b0000", "#000000"]

profiles:
  topography_test:
    processing_mode: "topography_flat"
    csv_mode: "default_scalar"
    plotting_modes: ["sample_bar_with_error", "heatmap_grid", "heatmap_grid_std"]
